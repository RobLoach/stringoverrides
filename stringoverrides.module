<?php
// $Id$

/**
 * @file
 * Configuration interface to provide a quick and easy way of replacing text.
 */

/**
 * Implementation of hook_help()
 */
function stringoverrides_help($path) {
  $output = '';
  if ($path == 'admin/help#stringoverrides') {
    $output = '<p>'.  t('The String Overrides module provides a quick and easy way of replacing text.') .'</p>';
  }
  else if(arg(0) == 'admin' && arg(1) == 'settings' && arg(2) == 'stringoverrides') {
    $output = '<p>'.  t("The following provides quick and easy way of replacing text.") .'</p>';
  }
  return $output;
} // function stringoverrides_help

/**
 * Implementation of hook_menu()
 */
function stringoverrides_menu($may_cache) {
  $items = array();
  if ($may_cache) {
    $items[] = array(
      'path' => 'admin/settings/stringoverrides',
      'title' => 'String overrides',
      'description' => 'Provides a quick and easy way of replacing text on the site.',
      'callback' => 'drupal_get_form',
      'callback arguments' => array('stringoverrides_admin'),
      'access' => user_access('administer site configuration'),
      'type' => MENU_NORMAL_ITEM,
    );
  }
  elseif (strpos($_GET['q'], 'admin/settings/stringoverrides') === 0) {
    include_once(drupal_get_path('module', 'stringoverrides') .'/stringoverrides.admin.inc');
  }

  return $items;
} // function stringoverrides_menu

/**
 * Check that locale module is disabled before enabling this module.
 */
function stringoverrides_enable() {
  if (module_exists('locale')) {
  	drupal_set_message(t('String overrides module is not compatible with Locale module. Please disable it before using String overrides.'), 'error');
    module_disable(array('stringoverrides'));
  }
}

/**
 * Fake the locale function.
 */
if (!function_exists('locale')) {
  function locale_supported_languages($reset = FALSE, $getall = FALSE) {
    return array(
      'name' => array('xx' => 'String Overrides'),
      'formula' => array('xx' => ''),
    );
  }

	function locale($string) {
    static $strings = array();
    $strings = variable_get('locale_custom_strings_en', array());
    if ($strings[$string]) {
    	return $strings[$string];
    }
    else {
    	return $string;
    }
	}
}
